{"version":3,"file":"debug-composer.js","sources":["../src/logger.js","../src/debugTools.js","../src/index.js"],"sourcesContent":["import debug from 'debug';\n\nconst createTooler = (namespace, debugInstances) => {\n  const timestamps = {};\n  return {\n    time(name, log = false) {\n      timestamps[name] = performance.now();\n      if (log) {\n        if (!debugInstances[`${namespace}:time`]) {\n          debugInstances[`${namespace}:time`] = debug(`${namespace}:time`);\n        }\n        debugInstances[`${namespace}:time`](`${name}: ${timestamps[name]}ms`);\n      }\n      return performance.now();\n    },\n    timeEnd(name, log = true) {\n      let time = performance.now();\n      if (timestamps[name]) {\n        time = time - timestamps[name];\n      }\n      if (log) {\n        if (!debugInstances[`${namespace}:time`]) {\n          debugInstances[`${namespace}:time`] = debug(`${namespace}:time`);\n        }\n        debugInstances[`${namespace}:time`](`${name}: ${time}ms`);\n      }\n      return time;\n    },\n    testPerformance(cb, times = 1, log = true) {\n      let time = 0;\n      if (times === 1) {\n        time = performance.now();\n        cb();\n        time = performance.now() - time;\n      } else {\n        time = performance.now();\n        for (let i = 0; i <= times; i++) {\n          cb();\n        }\n        time = performance.now() - time;\n      }\n      if (log) {\n        if (!debugInstances[`${namespace}:performance`]) {\n          debugInstances[`${namespace}:performance`] = debug(`${namespace}:performance`);\n        }\n        debugInstances[`${namespace}:performance`](\n          `Function triggered ${times === 1 ? 'once' : `${times} times`}. Measured time: ${time}ms`\n        );\n      }\n\n      return time;\n    }\n  };\n};\n\nconst createLogger = (namespace, addToGlobals = false) => {\n  const debugInstances = {};\n  const tooler = createTooler(namespace, debugInstances);\n  const logger = new Proxy({}, {\n    get(target, name) {\n      if (tooler[name]) {\n        return tooler[name];\n      }\n      if (!debugInstances[`${namespace}:${name}`]) {\n        debugInstances[`${namespace}:${name}`] = debug(`${namespace}:${name}`);\n      }\n      return (...args) => debugInstances[`${namespace}:${name}`](...args);\n    },\n  });\n  const globalName = typeof addToGlobals === 'string' ? addToGlobals : 'logger';\n  if (addToGlobals) {\n    if (typeof window !== 'undefined') {\n      window[globalName] = logger;\n    } else if (typeof global !== 'undefined') {\n      global[globalName] = logger;\n    } else {\n      console.warn('debug-composer:warn', 'Could not find neither window nor global object to add logger to'); // eslint-disable-line no-console\n    }\n  }\n  return logger;\n};\n\nexport default createLogger;\n","import _ from 'lodash';\nimport createLogger from './logger';\n\nconst logger = createLogger('debug-composer');\n\nconst debugTools = {\n  /**\n   * Gets debug settings from localStorage\n   * @return {string} debug settings\n   */\n  getFromLocalStorage() {\n    if (typeof localStorage !== 'undefined') {\n      return localStorage.getItem('debug');\n    }\n    return '';\n  },\n\n  /**\n   * Sets debug settings to localStorage\n   * @param {string} value debug settings as string\n   */\n  setToLocalStorage(value) {\n    if (typeof localStorage !== 'undefined') {\n      localStorage.setItem('debug', value);\n    }\n  },\n\n  /**\n   * Clear debug options in localStorage\n   */\n  clearLocalStorage() {\n    if (typeof localStorage !== 'undefined') {\n      localStorage.removeItem('debug');\n    }\n  },\n\n  /**\n   * Sets provided settings as string to localStorage\n   * @param {object} settings - debug settings as js object\n   * @param {string|number} enable - debug settings level to enable (the same as index in settings object to be set)\n   */\n  configureDebugger(settings, enable = 'default') {\n    if (typeof settings !== 'object') {\n      throw new Error(`Expected an object provided as the first argument to configureDebugger function. ${typeof settings} found instead.`);\n    }\n    if (!settings[enable]) {\n      throw new Error(`Key ${enable} not found in settings file provided to configureDebugger method. As a second argument you must provide index from settings object`);\n    }\n    if (typeof settings[enable] !== 'object') {\n      throw new Error(`Expected settings.${enable} to be an object. ${typeof settings[enable]} found instead`);\n    }\n    if (typeof window === 'undefined' || typeof localStorage === 'undefined') {\n      logger.warning('It seems that you are using configureDebugger method in node.js or in outdated browser. It will not work as it needs browser environment with localStorage available.');\n    }\n\n    logger.info(`Setting debug for ${enable}`);\n\n    let options = debugTools.getDebugOptionsObject(debugTools.getFromLocalStorage());\n    _.forEach(settings[enable], (level, namespace) => {\n      options = debugTools.changeDebugOption(level)(options, namespace);\n    });\n    debugTools.setToLocalStorage(debugTools.getDebugOptionsString(options));\n  },\n\n  /**\n   * Converts debugString (as saved in localStorage) to object\n   * @param {object} debugString - debug settings string\n   * @return {object} debug setting object\n   */\n  getDebugOptionsObject(debugString) {\n    if (!debugString) {\n      return {};\n    }\n    let options = debugString;\n    options = _.map(options.split(','), el => el.split(';'));\n    options = _.flatten(options);\n    options = _.reduce(options, (accu, val) => {\n      const enabled = val.indexOf('-') !== 0;\n      const split = val.replace(/^-/, '').split(':');\n      if (!accu[split[0]]) {\n        accu[split[0]] = {};\n      }\n      if (split.length === 2) {\n        accu[split[0]][split[1]] = enabled;\n      } else {\n        accu[split[0]]._default = enabled;\n      }\n      return accu;\n    }, {});\n    return options;\n  },\n\n  /**\n   * Converts debugOptions object to string that can be saved to localStorage\n   * @param {object} optionsObject - debug options as object\n   * @return {string} optionsString - debug options as string\n   */\n  getDebugOptionsString(optionsObject) {\n    let options = optionsObject;\n    options = _.reduce(options, (accu, namespaceOptions, namespaceName) => {\n      _.forEach(namespaceOptions, (namespaceOption, subNamespaceName) => {\n        if (subNamespaceName === '_default') {\n          accu.push(`${namespaceOption ? '' : '-'}${namespaceName}`);\n        } else {\n          accu.push(`${namespaceOption ? '' : '-'}${namespaceName}:${subNamespaceName}`);\n        }\n      });\n      return accu;\n    }, []);\n    return options.join(',');\n  },\n\n  /**\n   * Returns the function that enable or disable (based on enable parameter) given namespace in optionsObject and returns that object\n   * @param {boolean} enable flag that indicates if returned function should enable or disable namespaces\n   * @return {function} function to be used for disabling/enabling namespaces\n   */\n  changeDebugOption(enable) {\n    /**\n     * Function to be used for disabling/enabling namespaces\n     * @param {object} optionsObject - debug options to be edited (as JS object)\n     * @param {string} namespace - namespace to be enabled/disabled (e.g. 'socket.io-client' or 'mi18n-redux:info')\n     * @param {number} level - if set to 0 and provided with outer namespace (like 'debug' and not 'debug:warning') the namespace with asterisk (e.g. 'debug:*') will be added as well\n     * @return {object} new optionsObject - modified debug options as js object\n     */\n    return (optionsObject, namespace, level = 0) => {\n      const splitNamespace = namespace.split(':');\n      let newOptions = {\n        ...optionsObject,\n      };\n\n      if (splitNamespace.length === 1) {\n        // console.log('length=1', splitNamespace, enable, newOptions);\n        if (namespace === '*') {\n          if (enable) {\n            newOptions = {\n              ...newOptions,\n              '*': { _default: true },\n            };\n            // console.log('length=1 *', splitNamespace, enable, newOptions);\n          } else {\n            delete newOptions['*'];\n          }\n        } else if (level === 0) {\n          newOptions = {\n            ...newOptions,\n            [splitNamespace[0]]: { _default: enable, '*': enable },\n          };\n        } else {\n          newOptions = {\n            ...newOptions,\n            [splitNamespace[0]]: {\n              ...newOptions[splitNamespace[0]],\n              _default: enable,\n            },\n          };\n        }\n      } else {\n        // console.log('length!=1', newOptions[splitNamespace[0]]);\n        newOptions = {\n          ...newOptions,\n          [splitNamespace[0]]: {\n            ...newOptions[splitNamespace[0]],\n            [splitNamespace[1]]: enable,\n          },\n        };\n        // console.log('length!=1', splitNamespace, enable, newOptions);\n      }\n      return newOptions;\n    };\n  },\n\n  /**\n   * Enables given namespace (with saving to localStorage)\n   * @param {string} namespace - namespace to be enabled\n   * @param {number} level - if set to 0 and provided with outer namespace (like 'debug' and not 'debug:warning') the namespace with asterisk (e.g. 'debug:*') will be added as well\n   * @return {void}\n   */\n  enableDebug(namespace = '*', level = 0) {\n    const debugOptions = debugTools.getDebugOptionsObject(debugTools.getFromLocalStorage());\n    const modifiedDebugOptions = debugTools.changeDebugOption(true)(debugOptions, namespace, level);\n    debugTools.setToLocalStorage(debugTools.getDebugOptionsString(modifiedDebugOptions));\n  },\n\n  /**\n   * Disables given namespace (with saving to localStorage)\n   * @param {string} namespace - namespace to be disabled\n   * @param {number} level - if set to 0 and provided with outer namespace (like 'debug' and not 'debug:warning') the namespace with asterisk (e.g. 'debug:*') will be added as well\n   * @return {void}\n   */\n  disableDebug(namespace = '*', level = 0) {\n    const debugOptions = debugTools.getDebugOptionsObject(debugTools.getFromLocalStorage());\n    const modifiedDebugOptions = debugTools.changeDebugOption(false)(debugOptions, namespace, level);\n    debugTools.setToLocalStorage(debugTools.getDebugOptionsString(modifiedDebugOptions));\n  },\n\n  /**\n   * Returns current debug options from localStorage\n   * @return {object} debug options as JS object\n   */\n  getDebugOptions() {\n    return this.getDebugOptionsObject(localStorage.getItem('debug'));\n  },\n};\n\nexport default debugTools;\n","import debugTools from './debugTools';\nimport createLogger from './logger';\n\nexport const configureDebugger = debugTools.configureDebugger;\nexport const resetDebugger = debugTools.clearLocalStorage;\nexport default createLogger;\n"],"names":["createTooler","namespace","debugInstances","timestamps","name","log","performance","now","debug","time","cb","times","i","createLogger","addToGlobals","tooler","logger","Proxy","target","globalName","window","global","warn","debugTools","localStorage","getItem","value","setItem","removeItem","settings","enable","Error","babelHelpers.typeof","warning","info","options","getDebugOptionsObject","getFromLocalStorage","forEach","level","changeDebugOption","setToLocalStorage","getDebugOptionsString","debugString","_","map","split","el","flatten","reduce","accu","val","enabled","indexOf","replace","length","_default","optionsObject","namespaceOptions","namespaceName","namespaceOption","subNamespaceName","push","join","splitNamespace","newOptions","debugOptions","modifiedDebugOptions","configureDebugger","resetDebugger","clearLocalStorage"],"mappings":"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"}